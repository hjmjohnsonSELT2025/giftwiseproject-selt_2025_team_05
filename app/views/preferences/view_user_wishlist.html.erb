<div class="wishlist-green-theme">
  <div class="container py-4">
    <div class="text-center mb-4">
      <h2 class="mb-1"><%= @user.first_name %>'s Wishlist</h2>
      <p class="text-muted mb-0">Claim a gift from <%= @user.first_name %>'s wishlist to purchase. Or, add your own gift
        suggestion with the "Add Gift" button below.</p>
    </div>

    <% if @preferences.any? %>
      <div class="table-responsive">
        <table class="table table-striped align-middle mb-0">
          <thead class="table-light">
          <tr>
            <th>Wishlist Item</th>
            <th>Cost</th>
            <th>Details</th>
            <th>Claimed By</th>
          </tr>
          </thead>
          <tbody>

          <% @preferences.each do |item| %>
            <tr>

              <td><%= "#{item.item_name}" %></td>
              <td> <%= "#{number_to_currency(item.cost)}" %></td>
              <td> <%= "#{item.notes}" %></td>
              <td>
                <% if !item.giver.nil? %>

                  <% if item.giver == current_user %>
                    <% if item.event != @event %>
                      <p> You already claimed this item in another event <%= item.event.name %></p>
                    <% else %>
                      <%= "#{item.giver.first_name}" %>
                      <%= button_to "Unclaim",
                                    unclaim_preference_preferences_path(item_id: item.id, user_id: current_user.id, event_id: @event.id, redirect: "wishlist"),
                                    method: :post,
                                    class: "btn btn-sm btn-danger" %></td>
                    <% end %>
                  <% else %>
                    <p>Someone else</p>
                  <% end %>
                <% else %>
                  <%= button_to "Claim this gift",
                                claim_preference_preferences_path(item_id: item.id, user_id: current_user.id, event_id: @event.id),
                                method: :post,
                                class: "btn btn-sm btn-success" %>
                <% end %>
                </td>

                </tr>

          <% end %>

          </tbody>
        </table>
      </div>
    <% else %>
      <p>No items on wish list yet.</p>
    <% end %>

    <div class="d-flex gap-2 mt-3">
      <p class="text-muted mb-0">Want to give <%= @user.first_name %> something not on their wishlist?</p>
    </div>
    <div class="d-flex gap-2 mt-3">
      <%= link_to "Add custom gift suggestion", new_suggestion_path(user_id: @user.id, event_id: @event.id), class: "btn btn-orange" %>
    </div>
    <div class="d-flex gap-2 mt-3">
      <%= link_to "Generate gift ideas with AI Gift Assistant",
                  event_event_user_gift_suggestions_path(@event, @event_user),
                  class: "btn btn-orange" %>
    </div>
    <br>
    <%= link_to "Back", user_gift_summary_path(user_id: @user.id, event_id: @event.id), class: "btn btn-secondary" %>
  </div>
</div>
