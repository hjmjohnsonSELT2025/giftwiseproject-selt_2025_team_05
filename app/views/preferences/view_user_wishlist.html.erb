<div class="container py-4">
  <div class="text-center mb-4">
    <h2 class="mb-1"><%= @user.first_name %>'s Gifts for <%= @event.name %></h2>
    <p class="text-muted mb-0">Claim an item or add a new gift idea for this event</p>
  </div>

  <% if @preferences.any? %>
    <table class="table table-striped" style="max-width: 600px;">
      <thead>
      <tr>
        <th>Item Name</th>
        <th>Cost</th>
        <th>Details</th>
        <th>Claimed By</th>
      </tr>
      </thead>
      <tbody>

      <% @preferences.each do |item| %>
      <tr>

          <td><%= "#{item.item_name}" %></td>
          <td> <%= "#{number_to_currency(item.cost)}" %></td>
          <td> <%= "#{item.notes}" %></td>
        <td>
          <% if !item.giver.nil? %>

            <% if item.giver == current_user %>
              <%if item.event != @event %>
               <p> You already claimed this item in another event <%=item.event.name %></p>
              <%else %>
                <%= "#{item.giver.first_name}" %>
                <%= button_to "Unclaim",
                              unclaim_preference_preferences_path(item_id: item.id, user_id: current_user.id, event_id: @event.id, redirect: "wishlist"),
                              method: :post,
                              class: "btn btn-sm btn-danger" %></td>
              <% end %>
            <% else %>
              <p>Someone else</p>
            <% end %>
          <% else %>
            <%= button_to "Claim this gift",
                              claim_preference_preferences_path(item_id: item.id, user_id: current_user.id, event_id: @event.id),
                              method: :post,
                          class: "btn btn-sm btn-success" %>
          <% end %>
          </td>

          </tr>

      <% end %>

      </tbody>
    </table>
  <% else %>
    <p>No items on wish list yet.</p>
  <% end %>


  <div class="d-flex gap-2 mt-3">
    <%= link_to "Add my own gift suggestion", new_suggestion_path(user_id: @user.id, event_id: @event.id), class: "btn btn-primary" %>
    <br>
    <br>
    <%= link_to "Generate gift ideas with AI Gift Assistant",
                event_event_user_gift_suggestions_path(@event, @event_user),
                class: "btn btn-primary" %>
  </div>
</div>
<br>
    <br>
<%= link_to "Back", user_gift_summary_path(user_id: @user.id, event_id: @event.id), class: "btn btn-secondary" %>