<!DOCTYPE html>
<html>
<head>
  <title>‚ùÑÔ∏è GiftWise - Happy Holidays! ‚ú®</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

  <%= javascript_importmap_tags %>
</head>

<body>

<!-- Holiday Lights at the top -->
<div class="christmas-lights">
  <% 40.times do %>
    <div class="light-bulb"></div>
  <% end %>
</div>

<!-- Snowfall Effect -->
<div class="snowfall" id="snowfall"></div>

<!-- Snowflake Decorations -->
<div class="snowflake-corner snowflake-top-left">‚ùÑÔ∏è</div>
<div class="snowflake-corner snowflake-top-right">‚ùÑÔ∏è</div>

<!-- Gift Decoration -->
<div class="gift-decoration">üéÅ</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
  <div class="container">

    <!-- LEFT: GiftWise brand - Holiday Edition -->
    <%= link_to "üéÅ GiftWise ‚ú®", root_path, class: "navbar-brand" %>

    <!-- Toggle button for mobile view -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- CENTER: Navigation Tabs -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <% if user_signed_in? %>
        <ul class="navbar-nav">
          <li class="nav-item">
            <%= link_to "Events", root_path, class: "nav-link px-3 fw-semibold #{'active text-primary' if current_page?(root_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Friends", friendships_path, class: "nav-link px-3 fw-semibold #{'active text-primary' if current_page?(friendships_path)}" %>
          </li>
          <li class="nav-item">
            <!-- If this route is not defined yet, change to root_path temporarily -->
            <%= link_to "My Wishlist", preferences_path, class: "nav-link px-3 fw-semibold #{'active text-primary' if current_page?(preferences_path)}" %>
          </li>
        </ul>
      <% end %>
    </div>

    <!-- RIGHT: User menu -->
    <div class="d-flex align-items-center gap-3">
      <% if user_signed_in? %>

        <span class="fw-semibold d-none d-md-inline">Hi, <%= current_user.first_name %>!</span>

        <%= link_to "View Profile",
                    user_show_path,
                    class: "btn btn-outline-primary btn-sm" %>

        <%= button_to "Sign out",
                      destroy_user_session_path,
                      method: :delete,
                      class: "btn btn-outline-danger btn-sm",
                      form: { class: "d-inline" } %>

      <% else %>

        <%= link_to "Sign in",
                    new_user_session_path,
                    class: "btn btn-outline-primary btn-sm" %>

      <% end %>
    </div>

  </div>
</nav>

<!-- Holiday Star - scrolls with page content -->
<div class="christmas-star">‚≠ê</div>

<% flash.each do |type, message| %>
  <% if message.present? %>
    <% bootstrap_class =
         case type.to_sym
         when :notice then "alert-success"
         when :alert  then "alert-warning"
         else "alert-info"
         end
    %>
    <div class="container mt-3">
      <div class="alert <%= bootstrap_class %> alert-dismissible fade show text-center" role="alert">
        <%= message %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    </div>
  <% end %>
<% end %>

<%= yield %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

<!-- ‚ùÑÔ∏è Holiday Snowfall Animation ‚ùÑÔ∏è -->
<script>
  // Use turbo:load for Turbo Drive navigation, works on every page change
  document.addEventListener('turbo:load', initSnowfall);
  // Also listen for DOMContentLoaded as fallback
  document.addEventListener('DOMContentLoaded', initSnowfall);
  
  let snowfallInitialized = false;
  let snowfallInterval = null;
  
  function initSnowfall() {
    const snowfall = document.getElementById('snowfall');
    if (!snowfall) return;
    
    // Clear any existing snowflakes and interval
    snowfall.innerHTML = '';
    if (snowfallInterval) {
      clearInterval(snowfallInterval);
    }
    
    const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚ùã', '‚ú∫', '‚Ä¢'];
    const maxSnowflakes = 50;
    
    function createSnowflake() {
      if (snowfall.children.length >= maxSnowflakes) return;
      
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.innerHTML = snowflakes[Math.floor(Math.random() * snowflakes.length)];
      flake.style.left = Math.random() * 100 + 'vw';
      flake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
      flake.style.opacity = Math.random() * 0.6 + 0.4;
      flake.style.animationDuration = (Math.random() * 5 + 5) + 's';
      flake.style.animationDelay = Math.random() * 2 + 's';
      
      snowfall.appendChild(flake);
      
      // Remove snowflake after animation completes
      setTimeout(() => {
        if (flake.parentNode) {
          flake.remove();
        }
      }, 12000);
    }
    
    // Create initial snowflakes
    for (let i = 0; i < 20; i++) {
      setTimeout(createSnowflake, i * 200);
    }
    
    // Continuously create new snowflakes
    snowfallInterval = setInterval(createSnowflake, 300);
  }
</script>
</body>
</html>