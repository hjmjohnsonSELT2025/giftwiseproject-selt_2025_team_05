<h1>My Gifts to  <%= @recipient.first_name %> for <%= @event.name %></h1>
<h5>These are all the gift's you're planning to get for <%= @recipient.first_name %>.</h5>
<h5>Click "Add Gift" to add a gift from <%= @recipient.first_name %>'s wishlist or create your own gift suggestion.</h5>
<h5>You can edit or delete gift suggestions that you create yourself. If the gift is from <%= @recipient.first_name %>'s wishlist,
you can unclaim the gift to remove it from your list.</h5>

<% if @combined_items.any? %>
  <table class="table table-striped" style="max-width: 600px;">
    <thead>
    <tr>
      <th>Item Name</th>
      <th>Cost</th>
      <th>Details</th>
      <th>Purchased?</th>
      <th>Wishlist Info</th>
      <th>Manage</th>
    </tr>
    </thead>
    <tbody>

    <% @combined_items.each do |item| %>
      <tr>

        <td><%= "#{item.item_name}" %></td>
        <td> <%= "#{number_to_currency(item.cost)}" %></td>
        <td> <%= "#{item.notes}" %></td>

        <td>
          <% if item.class.name == "Suggestion"%>
            <!-- Checkbox based off of ChatGPT response -->
            <%= form_with model: item, url: toggle_purchase_suggestion_suggestion_path(item), method: :post, local: true do |f| %>

              <%= f.check_box :purchased, checked: item.purchased,  onchange: 'this.form.submit();', disabled: (item.user != current_user) %>

            <% end %>
          <%else %>
            <%= form_with model: item, url: toggle_purchase_preference_path(item), method: :post, local: true do |f| %>

              <%= f.check_box :purchased, checked: item.purchased,  onchange: 'this.form.submit();', disabled: (item.giver != current_user) %>

            <% end %>
          <%end %>
        </td>
        <td>
          <% if item.class.name == "Preference"%>
            <p>On <%= @recipient.first_name %>'s Wishlist</p>
          <%end %>
        </td>
        <td>
          <% if item.class.name == "Suggestion"%>
            <!-- Can edit or remove the suggestion -->
            <%= link_to "Edit or Delete Gift", edit_suggestion_path(id: item.id), class: "btn btn-primary" %>
        <%else %>
            <!-- Unclaim button -->
            <%= button_to "Unclaim Wishlist Gift",
                          unclaim_preference_summary_preferences_path(item_id: item.id, event_id: @event.id, user_id: current_user.id),
                          form: {data: { turbo_confirm: "Are you sure you want to unclaim this wishlist gift?" }},
                          class: "btn btn-danger" %>
          <%end %>
        </td>
      </tr>

    <% end %>

    </tbody>
  </table>
<% else %>
  <p>No gifts yet.</p>
<% end %>

<%= link_to "Add Gift", view_user_wishlist_preferences_path(user_id: @recipient.id, event_id: @event.id), class: "btn btn-primary" %>

