<% title = @view_mode == 'past' ? 'Past Events' : 'Upcoming Events' %>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
    <div>
      <h2 class="h4 mb-1"><%= title %></h2>
      <p class="text-muted mb-0">Manage invites, view events, or create a new one.</p>
    </div>
    <%= link_to "Create Event", new_event_path, class: "btn btn-primary" %>
  </div>

  <div class="mb-3">
    <div class="btn-group" role="group">
      <%= link_to "Upcoming Events", root_path(view: 'upcoming'), class: "btn btn-outline-primary #{'active' if @view_mode == 'upcoming'}" %>
      <%= link_to "Past Events", root_path(view: 'past'), class: "btn btn-outline-primary #{'active' if @view_mode == 'past'}" %>
    </div>
  </div>

  <% if @event_users.any? %>
    <table class="table table-striped table-hover align-middle">
      <thead>
      <tr>
        <th>Name</th>
        <th>Date</th>
        <th>Address</th>
        <th>Type</th>
        <th>Organizer</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <% @event_users.each do |event_user| %>
        <% event = event_user.event %>
        <% row_class = @view_mode == 'past' ? 'table-secondary text-muted' : '' %>
        <tr class="<%= row_class %>">
          <td><%= event.name %></td>
          <td><%= event.date&.strftime("%B %d, %Y") %></td>
          <td><%= event.address %></td>
          <td><%= event.event_type&.titleize %></td>
          <td><%= [event.user&.first_name, event.user&.last_name].compact.join(" ").presence || "â€”" %></td>
          <td>
            <% if event_user.status == 'joined' %>
              <span class="badge bg-success">Joined</span>
            <% elsif event_user.status == 'invited' %>
              <span class="badge bg-warning text-dark">Pending Invite</span>
            <% else %>
              <span class="badge bg-secondary"><%= event_user.status.humanize %></span>
            <% end %>
          </td>
          <td>
            <div class="d-flex gap-2">
              <%= link_to "View", event_path(event), class: "btn btn-sm btn-outline-primary" %>

              <% if event_user.status == 'invited' && @view_mode != 'past' %>
                <%= button_to "Accept",
                              event_event_user_path(event, event_user, status: 'joined'),
                              method: :patch,
                              class: "btn btn-sm btn-success" %>

                <%= button_to "Decline",
                              event_event_user_path(event, event_user, status: 'declined'),
                              method: :patch,
                              data: { turbo_confirm: "Are you sure you want to decline this invitation?" },
                              class: "btn btn-sm btn-outline-danger" %>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="mt-3">You haven't joined any events yet.</p>
  <% end %>
</div>
