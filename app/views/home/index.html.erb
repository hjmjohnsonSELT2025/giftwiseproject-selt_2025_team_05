<h1>Upcoming Events</h1>

<% if @upcoming_events.any? %>
  <table class="table table-striped table-hover align-middle">
    <thead>
    <tr>
      <th>Name</th>
      <th>Date</th>
      <th>Address</th>
      <th>Type</th>
      <th>Organizer</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <% @upcoming_events.each do |event_user| %>
      <% event = event_user.event %>
      <tr>
        <td><%= event.name %></td>
        <td><%= event.date&.strftime("%B %d, %Y") %></td>
        <td><%= event.address %></td>
        <td><%= event.event_type.titleize %></td>
        <td><%= event.user.first_name + " " + event.user.last_name %></td>
        <td>
          <% if event_user.status == 'invited' || event_user.status == 'pending' %>
            <span class="badge bg-warning text-dark">Pending Invite</span>
          <% else %>
            <span class="badge bg-secondary"><%= event_user.status.humanize %></span>
          <% end %>
        </td>
        <td>
          <div class="d-flex gap-2">
            <%= link_to "View", event_path(event), class: "btn btn-sm btn-outline-primary" %>

            <!-- Accept Invite Button -->
            <% if event_user.status == 'invited' || event_user.status == 'pending' %>
              <%= button_to "Accept",
                            event_event_user_path(event, event_user),
                            method: :patch,
                            class: "btn btn-sm btn-success" %>
            <% end %>
          </div>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% else %>
  <p class="mt-3">You haven't joined any upcoming events yet.</p>
<% end %>

<%= link_to "Create Event", new_event_path, class: "btn btn-primary mt-2" %>